<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ferguson pics</title>

    <style>
        body {
            background-color: black;
            color: white;
            text-align: center;
            font-family: Arial, sans-serif;
            margin: 0;
        }

        p {
            padding-top: 1rem;
            font-size: 1.25rem;
        }
        h1 {
            font-size: 2.5rem;
        }

        #image-frame {
            width: 100vw;
            overflow: hidden;
            margin: auto;
            background-size: contain;
        }
        img {
            display: block;
            margin: auto;
            height: auto;
            max-height: 75vh;
            max-width: 90%;
        }
    </style>
</head>
<body>
<h1>ferguson:</h1>
<div id="image-frame">
    <p>i think javascript is disabled :( no ferg for u rip</p>
</div>

<script type="module">
    import jsCookie from 'https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/+esm';
    const Cookies = jsCookie;

    const picsAvailable = 272;
    const max_length = 30;

    // get the cookie yumm tasty
    let cookie = Cookies.get('picsSeen');
    let picsSeen;
    if (!cookie) {
        picsSeen = [];
    } else {

        picsSeen = cookie.split(",");
    }

    // limit the length of picsSeen to max_length
    if (picsSeen.length === max_length) {
        picsSeen.shift();
    } else if (picsSeen.length > max_length) {
        picsSeen.splice(0, picsSeen.length - max_length);

    }

    function getRandomInt(max, excluded) {
        const min = 1;
        let randomInt;
        do {
            randomInt = Math.floor(Math.random() * (max - min + 1)) + min;
        } while (excluded.includes(randomInt));
        return randomInt;
    }

    const randomNum = getRandomInt(picsAvailable, picsSeen.map(Number));
    const imagePath = `pics/${randomNum}.webp`;

    //console.log(`picsSeen: ${picsSeen}\nlength: ${picsSeen.length}\nrandomNum: ${randomNum} (in list? ${picsSeen.map(Number).includes(randomNum)})`);
    picsSeen.push(randomNum);

    Cookies.set('picsSeen', picsSeen.toString(), {expires: 7});

    // Set the image source
    document.getElementById('image-frame').innerHTML = `<img src="${imagePath}" alt="Picture of the cat named Ferguson"><p>reload the page for another pic :3</p>`;
</script>
</body>
</html>